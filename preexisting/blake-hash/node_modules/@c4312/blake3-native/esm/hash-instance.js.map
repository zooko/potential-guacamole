{"version":3,"file":"hash-instance.js","sourceRoot":"","sources":["../src/hash-instance.ts"],"names":[],"mappings":"AAAA,OAAO,EAAqD,YAAY,EAAE,MAAM,wBAAwB,CAAC;AACzG,OAAO,EAAE,SAAS,EAAqB,MAAM,QAAQ,CAAC;AAEtD,YAAY;AACZ,OAAO,KAAK,MAAM,MAAM,yBAAyB,CAAC;AAElD,MAAM,CAAC,MAAM,UAAU,GAAG,GAAG,EAAE,CAAC,IAAI,QAAQ,CAAC,MAAM,CAAC,UAAU,EAAE,CAAC,CAAC;AAClE,MAAM,CAAC,MAAM,WAAW,GAAG,CAAC,GAAc,EAAE,EAAE,CAAC,IAAI,QAAQ,CAAC,MAAM,CAAC,WAAW,CAAC,YAAY,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC;AACnG,MAAM,CAAC,MAAM,eAAe,GAAG,CAAC,QAAmB,EAAE,EAAE,CACrD,IAAI,QAAQ,CAAC,MAAM,CAAC,eAAe,CAAC,YAAY,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC;AAE/D;;GAEG;AACH,MAAM,OAAO,QAAS,SAAQ,SAAS;IACrC,YACmB,IAIhB;QAED,KAAK,EAAE,CAAC;QANS,SAAI,GAAJ,IAAI,CAIpB;IAGH,CAAC;IAED;;OAEG;IACI,MAAM;QACX,OAAO,IAAI,CAAC,IAAI,CAAC,MAAM,EAAE,CAAC;IAC5B,CAAC;IAED;;OAEG;IACI,MAAM,CAAC,IAAe,EAAE,QAAyB;QACtD,IAAI,CAAC,IAAI,CAAC,MAAM,CACd,QAAQ,IAAI,OAAO,IAAI,KAAK,QAAQ,CAAC,CAAC,CAAC,MAAM,CAAC,IAAI,CAAC,IAAI,EAAE,QAAQ,CAAC,CAAC,CAAC,CAAC,YAAY,CAAC,IAAI,CAAC,CACxF,CAAC;QACF,OAAO,IAAI,CAAC;IACd,CAAC;IAED;;OAEG;IACI,OAAO;QACZ,QAAQ;IACV,CAAC;IAQM,MAAM,CACX,QAA4C,EAC5C,OAA0B;QAE1B,IAAI,YAA0C,CAAC;QAC/C,IAAI,WAAuC,CAAC;QAC5C,IAAI,QAAQ,IAAI,OAAO,QAAQ,KAAK,QAAQ,EAAE;YAC5C,YAAY,GAAG,QAAQ,CAAC;YACxB,WAAW,GAAG,SAAS,CAAC;SACzB;aAAM;YACL,YAAY,GAAG,OAAO,CAAC;YACvB,WAAW,GAAG,QAAQ,CAAC;SACxB;QAED,MAAM,MAAM,GAAG,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,YAAY,EAAE,MAAM,CAAC,CAAC;QACtD,OAAO,WAAW,CAAC,CAAC,CAAC,MAAM,CAAC,QAAQ,CAAC,WAAW,CAAC,CAAC,CAAC,CAAC,MAAM,CAAC;IAC7D,CAAC;IAED;;;OAGG;IACM,UAAU,CAAC,KAAsB,EAAE,QAAgB,EAAE,QAA2B;QACvF,IAAI,CAAC,MAAM,CAAC,KAAK,EAAE,QAA0B,CAAC,CAAC;QAC/C,QAAQ,EAAE,CAAC;IACb,CAAC;IAED;;;OAGG;IACM,MAAM,CAAC,QAA2B;QACzC,QAAQ,CAAC,IAAI,EAAE,IAAI,CAAC,MAAM,EAAE,CAAC,CAAC;IAChC,CAAC;CACF","sourcesContent":["import { HashInput, IBaseHashOptions, IHasher, IHashReader, inputToArray } from '@c4312/blake3-internal';\nimport { Transform, TransformCallback } from 'stream';\n\n//@ts-ignore\nimport * as native from '../build/Release/blake3';\n\nexport const createHash = () => new NodeHash(native.createHash());\nexport const createKeyed = (key: HashInput) => new NodeHash(native.createKeyed(inputToArray(key)));\nexport const createDeriveKey = (material: HashInput) =>\n  new NodeHash(native.createDeriveKey(inputToArray(material)));\n\n/**\n * @inheritdoc\n */\nexport class NodeHash extends Transform implements IHasher<Buffer> {\n  constructor(\n    private readonly hash: {\n      update(data: Uint8Array): void;\n      digest(length?: number): Buffer;\n      reader(): IHashReader<Buffer>;\n    },\n  ) {\n    super();\n  }\n\n  /**\n   * @reader\n   */\n  public reader() {\n    return this.hash.reader();\n  }\n\n  /**\n   * @inheritdoc\n   */\n  public update(data: HashInput, encoding?: BufferEncoding): this {\n    this.hash.update(\n      encoding && typeof data === 'string' ? Buffer.from(data, encoding) : inputToArray(data),\n    );\n    return this;\n  }\n\n  /**\n   * @inheritdoc\n   */\n  public dispose(): void {\n    // no-op\n  }\n\n  /**\n   * @inheritdoc\n   */\n  public digest(encoding?: IBaseHashOptions): Buffer;\n  public digest(encoding: undefined, options: IBaseHashOptions): Buffer;\n  public digest(encoding: BufferEncoding, options?: IBaseHashOptions): string;\n  public digest(\n    encoding?: IBaseHashOptions | BufferEncoding,\n    options?: IBaseHashOptions,\n  ): string | Buffer {\n    let resolvedOpts: IBaseHashOptions | undefined;\n    let resolvedEnc: BufferEncoding | undefined;\n    if (encoding && typeof encoding === 'object') {\n      resolvedOpts = encoding;\n      resolvedEnc = undefined;\n    } else {\n      resolvedOpts = options;\n      resolvedEnc = encoding;\n    }\n\n    const result = this.hash.digest(resolvedOpts?.length);\n    return resolvedEnc ? result.toString(resolvedEnc) : result;\n  }\n\n  /**\n   * @inheritdoc\n   * @hidden\n   */\n  override _transform(chunk: Buffer | string, encoding: string, callback: TransformCallback): void {\n    this.update(chunk, encoding as BufferEncoding);\n    callback();\n  }\n\n  /**\n   * @inheritdoc\n   * @hidden\n   */\n  override _flush(callback: TransformCallback): void {\n    callback(null, this.digest());\n  }\n}\n"]}